<app-viewer
  title="Metrics"
  [options]="['METADATA', 'COMPONENTS']"
  selectedOption="METADATA"
>
  <!-- METADATA -->
  <div body-1 style="width: 100%">
    <div *ngIf="qa" class="wrapper">
      <ng-container *ngTemplateOutlet="loading"></ng-container>
      <ng-container *ngTemplateOutlet="metadata"></ng-container>
      <ng-container *ngTemplateOutlet="filters"></ng-container>
    </div>
  </div>

  <!-- COMPONENTS  -->
  <div body-2 style="width: 100%; height: 100%">
    <div *ngIf="qa" class="wrapper">
      <ng-container *ngTemplateOutlet="loading"></ng-container>
      <ng-container *ngTemplateOutlet="displayComponents"></ng-container>
      <ng-container *ngTemplateOutlet="filters"></ng-container>
    </div>
  </div>

  <ng-template #metadata>
    <div class="list">
      <ng-container *ngFor="let test of components['metadata']">
        <!-- Test results -->
        <ng-container
          *ngFor="let testResult of getTestResults('metadata', test)"
        >
          <app-accordion *ngIf="isFiltered(testResult)">
            <div title class="test-result">
              <span>{{ testResult.message }}</span>
            </div>
            <div extra class="attributes">
              <div
                class="attribute"
                *ngFor="let tag of testResult.attributes"
                [ngStyle]="{ 'background-color': attributes[tag].color }"
                [ngbTooltip]="tag"
                placement="top"
              ></div>
            </div>
            <span body>{{ testResult.details }}</span>
          </app-accordion>
        </ng-container>
      </ng-container>
    </div>
  </ng-template>

  <ng-template #displayComponents>
    <div class="list">
      <ng-container *ngFor="let component of components | keyvalue">
        <app-accordion *ngIf="component && component.key !== 'metadata'">
          <div title>{{ component.key }}</div>
          <div body class="scroll-y">
            <!-- Tests -->
            <ng-container *ngFor="let test of component.value">
              <!-- Test results -->
              <ng-container
                *ngFor="let testResult of getTestResults(component.key, test)"
              >
                <app-accordion *ngIf="isFiltered(testResult)">
                  <div title class="test-result">
                    <span>{{ testResult.message }}</span>
                  </div>
                  <div extra class="attributes">
                    <div
                      class="attribute"
                      *ngFor="let tag of testResult.attributes"
                      [ngStyle]="{
                        'background-color': attributes[tag].color
                      }"
                      [ngbTooltip]="tag"
                      placement="top"
                    ></div>
                  </div>
                  <span body>{{ testResult.details }}</span>
                </app-accordion>
              </ng-container>
            </ng-container>
          </div>
        </app-accordion>
      </ng-container>
    </div>
  </ng-template>

  <ng-template #loading>
    <div *ngIf="!qa" class="loading flex center">
      <div>LOADING</div>
    </div>
  </ng-template>
  <ng-template #filters>
    <app-qa-filters
      [attributes]="attributes"
      [(palette)]="palette"
    ></app-qa-filters>
  </ng-template>
</app-viewer>
