<app-viewer
  title="Metrics"
  [options]="['METADATA', 'COMPONENTS']"
  selectedOption="METADATA"
>
  <!-- METADATA -->
  <div body-1 style="width: 100%">
    <ng-container *ngTemplateOutlet="loading"></ng-container>
    <div *ngIf="qa" class="wrapper">
      <ng-container *ngTemplateOutlet="metadata"></ng-container>
      <ng-container *ngTemplateOutlet="filters"></ng-container>
    </div>
  </div>

  <!-- COMPONENTS  -->
  <div body-2 style="width: 100%; height: 100%">
    <ng-container *ngTemplateOutlet="loading"></ng-container>
    <div *ngIf="qa" class="wrapper">
      <ng-container *ngTemplateOutlet="displayComponents"></ng-container>
      <ng-container *ngTemplateOutlet="filters"></ng-container>
    </div>
  </div>

  <ng-template #metadata>
    <div class="list">
      <!-- Test results -->
      <ng-container *ngFor="let testResult of getTestResults('metadata')">
        <app-accordion *ngIf="isFiltered(testResult)">
          <div title class="test-result">
            <span>
              <span
                ngbTooltip="FAIL"
                placement="top"
                *ngIf="testResult.status === 'FAIL'"
                class="material-symbols-outlined"
                style="color: var(--warn)"
              >
                error
              </span>
              {{ testResult.message }}</span
            >
          </div>
          <div extra class="attributes">
            <ng-container *ngFor="let tag of testResult.attributes">
              <div
                class="attribute"
                *ngIf="attributes[tag].shown"
                [ngStyle]="{ 'background-color': attributes[tag].color }"
                [ngbTooltip]="tag"
                placement="top"
              ></div>
            </ng-container>
          </div>
          <span body>{{ testResult.details }}</span>
        </app-accordion>
      </ng-container>
    </div>
  </ng-template>

  <ng-template #displayComponents>
    <div class="list">
      <ng-container *ngFor="let component of components | keyvalue">
        <app-accordion
          *ngIf="
            component &&
            component.key !== 'metadata' &&
            getTestResults(component.key).length
          "
        >
          <div title class="component-title">{{ component.key }}</div>
          <div body>
            <!-- Test results -->
            <ng-container
              *ngFor="let testResult of getTestResults(component.key)"
            >
              <app-accordion>
                <div title class="test-result">
                  <span>
                    <span
                      ngbTooltip="FAIL"
                      placement="top"
                      *ngIf="testResult.status === 'FAIL'"
                      class="material-symbols-outlined"
                      style="color: var(--warn)"
                    >
                      error
                    </span>
                    {{ testResult.message }}</span
                  >
                </div>
                <div extra class="attributes">
                  <ng-container *ngFor="let tag of testResult.attributes">
                    <div
                      *ngIf="attributes[tag].shown"
                      class="attribute"
                      [ngStyle]="{
                        'background-color': attributes[tag].color
                      }"
                      [ngbTooltip]="tag"
                      placement="top"
                    ></div>
                  </ng-container>
                </div>
                <span body>{{ testResult.details }}</span>
              </app-accordion>
            </ng-container>
          </div>
        </app-accordion>
      </ng-container>
    </div>
  </ng-template>

  <ng-template #loading>
    <div *ngIf="!qa" class="loading flex center">
      <div>LOADING</div>
    </div>
  </ng-template>

  <ng-template #filters>
    <app-qa-filters
      [(attributes)]="attributes"
      [(palette)]="palette"
      [(resultStatus)]="resultStatus"
    ></app-qa-filters>
  </ng-template>
</app-viewer>
